<?php
require('../_app/Library/PHPMailer/PHPMailerAutoload.php');

date_default_timezone_set( 'America/Sao_Paulo' );

$site = HOME;

?>
<!DOCTYPE html>
<!--[if IE 9]><html class="ie ie9"> <![endif]-->
<html lang="pt-br">
<head>
	<meta charset="utf-8">
</head>
<body>
	<?php
	$todososdados = filter_input_array(INPUT_POST, FILTER_DEFAULT);

	//$tokkenHotmart = "I0moWLsq7PcoVGP00AL0Z5IYXjHyMA3760381";
	$tokkenHotmart = "";


	$tokken = (!empty($_POST['hottok']) ? $_POST['hottok'] : '');

// DADOS DO CLIENTE
	$primeiroNomeComprador = (!empty($_POST['first_name']) ? $_POST['first_name'] : '');
	$segundoNomeComprador  = (!empty($_POST['last_name']) ? $_POST['last_name'] : '');
	$emailComprador        = (!empty($_POST['email']) ? $_POST['email'] : '');


// DADOS DA COMPRA
	$codigodatransacao     = (!empty($_POST['transaction']) ? $_POST['transaction'] : '');
/*
Forma de pagamento do comprador
Possíveis valores: 'billet', 'credit_card', 'debit_card', 'bank_transfer', 'moip_balance', 'bcash_balance', 'paypal','order.checkout.hotmart_balance'
*/
$formaPagamento        = (!empty($_POST['payment_type']) ? $_POST['payment_type'] : '');

/*
Enviado apenas em caso de venda de assinaturas. Trata-se do nome do plano adquirido
Números e letras de até 255 caracteres
*/
$PlanoAdquirido        = (!empty($_POST['name_subscription_plan']) ? $_POST['name_subscription_plan'] : '');

/*
Código do assinante
Números e letras de até 50 caracteres
*/
$codigoAssinante       = (!empty($_POST['subscriber_code']) ? $_POST['subscriber_code'] : '');

/*
Status da assinatura
Possíveis valores: 'Active', 'Inactive', 'Delayed', 'Canceled by client', 'Canceled by vendor', 'Canceled by admin', 'Expired', 'Started'
*/
$statusAssinatura      = (!empty($_POST['signature_status']) ? $_POST['signature_status'] : '');

/*
Valor total da compra
Número decimal de 0.01 até 9999999999999999999.99
*/
$valorTotaldaCompra    = (!empty($_POST['full_price']) ? $_POST['full_price'] : '');

// Status da Compra
/*
Possíveis valores: approved, canceled, billet_printed, refunded, dispute, completed, blocked, chargeback, delayed, expired, wayting_payment
*/
$statusDaCompra        = (!empty($_POST['status']) ? $_POST['status'] : '');

/*
Somente números com até 11 dígitos
O campo recurrency_period é enviado sempre que a compra é do tipo assinatura e ele é enviado para notificação de compra e cancelamento. Os valores possíveis para este campo são 7, 30, 60, 90, 180 e 360 e esses valores representam a periodicidade em dias do pagamento da respectiva assinatura. O preenchimento desse campo leva em consideração o status da assinatura que é enviado no campo 'subscription_status' e os valores possíveis são active, inactive, past_due, canceled, expired e started
*/
$periodoEmDias =  (!empty($_POST['recurrency_period']) ? $_POST['recurrency_period'] : '');

/*
Números e letras de até 255 caracteres
Status da assinatura (active, canceled, past_due, expired, started, inactive)
*/
$statusDaAssinatura = (!empty($_POST['subscription_status']) ? $_POST['subscription_status'] : '');




/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////                           COMEÇO TODA A VALIDACAO                                  ////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


$detalhesOcorrenciahot = print_r($todososdados, true);



if($todososdados['hottok'] == $tokkenHotmart):// INICIO DO PRIMEIRO IF

			// ENVIA O EMAIL PARA O CLIENTE
				///////////////////////////////
$Mailer = new PHPMailer();

	//Define que será usado SMTP
$Mailer->IsSMTP();

	//Enviar e-mail em HTML
$Mailer->isHTML(true);

	//Aceitar carasteres especiais
$Mailer->Charset = 'UTF-8';

	//Configurações
$Mailer->SMTPAuth = true;
$Mailer->SMTPSecure = 'ssl';

	//nome do servidor
$Mailer->Host = 'mail.pedido.top';
	//Porta de saida de e-mail 
$Mailer->Port = 465;

	//Dados do e-mail de saida - autenticação
$Mailer->Username = 'contato@pedido.top';
$Mailer->Password = 'mamaejkl2020';

	//E-mail remetente (deve ser o mesmo de quem fez a autenticação)
$Mailer->From = 'contato@pedido.top';

	//Nome do Remetente
$Mailer->FromName = 'Pedido Top';

	//Assunto da mensagem
$Mailer->Subject = 'Novo POST da hotmart';

$horario = date('d/m/Y - H:i:s');
	//Corpo da Mensagem
$Mailer->Body = "

DETALHES: <br /><br />

<pre>
".$detalhesOcorrenciahot."
</pre>

<br /><br />


PEDIDO TOP <hr> {$horario}

";

	//Corpo da mensagem em texto
$Mailer->AltBody = '';

	//Destinatario 
$Mailer->AddAddress('pedidotop@gmail.com');

if($Mailer->Send()){
	echo "E-mail enviado com sucesso";
}else{
	echo "Erro no envio do e-mail: " . $Mailer->ErrorInfo;
}
				///////////////////////////////
				// ENVIA O EMAIL PARA O CLIENTE



endif;

///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
?>
</body>
</html>
